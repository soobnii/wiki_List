### dockerfile 로 이클립스 개발환경 셋팅하기

> 1) virtualbox 를 이용해 도커머신에 도커서버 (vm) 생성 (이름 : manager) -> 구동 -> ssh 접속
```
docker-machine create --driver virtualbox manager
docker-machine start manager
docker ssh manager
```

> 2) 도커허브에 등록된 moricom/centos7-vnc-git 이미지 pull 해서 repository 에 업로드 
```
docker pull moricom/centos7-vnc-git
```

> 3) docker registory 에 등록한 이미지 컨테이너로 띄우기 
```
docker run -it --user 0 -d -p 5901:5901 -p 6901:6901 --name centos7-vnc-git moricom/centos7-vnc-git
```
```
-it : interactive (컨테이너와의 상호 입출력 활성화) + tty 모드(가상 터미널) 활성화  
       -> 컨테이너 실행되면, 컨테이너 안의 bash shell 실행
--user(-u) : 컨테이너 사용자 계정 이름 설정 
-d : 백그라운드모드(데몬모드)로 실행(외부에서 제어 가능, Ctrl+C 해도 컨테이너 종료 안됨)
-p : 호스트와 컨테이너의 포트를 연결 (호스트포트:컨테이너포트)
*user 0 으로 해야 vnc 접속 후 파일 변경할 수 있음
```

> 4) 도커 머신(VM) ip 확인 (->ex. 192.168.99.102) 후, vnc로 접속 (비번 : vncpassword - 해당 base이미지 도커허브에 있음)
```
docker-machine ip manager
exit
```

> 5) netsh (네트워크쉘) 를 이용한 포트포워딩(portproxy) 등록 -> 리스트 확인 -> 제거 
```
v4to4 : IPv4 주소를 IPv4주로소 맵핑 
(local IP:5901)192.168.2.82:5901 를 192.168.99.102:5901 로 포워딩 (아래 과정은 외부 PC 접속확인 시에 하는 것)
```

```
netsh interface portproxy add v4tov4 listenport=5901 listenaddress=192.168.2.82 connectport=5901 connectaddress=192.168.99.102
netsh interface portproxy show v4tov4
netsh interface portproxy delete v4tov4 listenport=5901 listenaddress=192.168.2.82
```

> 6) docker ssh 접속 후 폴더 생성 -> dockerfile 생성
```
mkdir test_eclipse
vi dockerfile
```

```
FROM moricom/centos7-vnc-git    # base 이미지 : moricom/centos7-vnc-git 

MAINTAINER soobnii  # 이미지 생성자 정보 

RUN mkdir app

WORKDIR app

USER 0 # 명령을 실행할 사용자 계정 

# wget : 웹 페이지로부터 파일을 다운받는 명령어
RUN wget http://apache.tt.co.kr/tomcat/tomcat-8/v8.5.56/bin/apache-tomcat-8.5.56.tar.gz && \
        tar -xzvf ./apache-tomcat-8.5.56.tar.gz

RUN wget http://ftp.jaist.ac.jp/pub/eclipse/technology/epp/downloads/release/2020-06/R/eclipse-jee-2020-06-R-linux-gtk-x86_64.tar.gz && \
       tar -zxvf eclipse-jee-2020-06-R-linux-gtk-x86_64.tar.gz

RUN wget https://github.com/frekele/oracle-java/releases/download/8u212-b10/jdk-8u212-linux-x64.tar.gz && \
                tar -zxvf jdk-8u212-linux-x64.tar.gz

# jdk 경로 설정
RUN perl -p -i -e '$.==3 and print "-vm\n/headless/app/jdk1.8.0_212/bin/java \n"' /headless/app/eclipse/eclipse.ini

# 해당 경로 모든 하위 폴더/파일에 권한 부여 
RUN chmod -R 755 /headless/app

USER 1000100001
```

> 7) dockerfile 로 이미지 빌드하고 컨테이너 띄우기 
```
docker build -t soobnii/centos7_eclipse_tomcat8_test .
docker run -it --user 0 -d -p 5901:5901 -p 6901:6901 --name centos7-ecilpse-tomcat8 soobnii/centos7_eclipse_tomcat8_test
```
 
> 8) 컨테이너 실행 후 vnc 접속해서 제대로 됐는지 확인
192.168.99.102:5901 로 접속 

> 9) 포트포워딩 후 외부PC에서 접속 확인  
```
netsh interface portproxy show v4tov4
netsh interface portproxy add v4tov4 listenport=5901 listenaddress=192.168.2.82 connectport=5901 connectaddress=192.168.99.102
netsh interface portproxy delete v4tov4 listenport=5901 listenaddress=192.168.2.82
```

> 10) 로그인 후 도커허브에 push
```
docker login
docker push soobnii/centos7_eclipse_tomcat8_test
```

> 11) vnc 접속 후 cli로 이클립스 개발환경 셋팅
```
mkdir app
cd app
wget http://apache.tt.co.kr/tomcat/tomcat-8/v8.5.56/bin/apache-tomcat-8.5.56.tar.gz && \
        tar xzvf ./apache-tomcat-8.5.56.tar.gz

wget http://ftp.jaist.ac.jp/pub/eclipse/technology/epp/downloads/release/2020-06/R/eclipse-jee-2020-06-R-linux-gtk-x86_64.tar.gz && \
       tar -zxvf eclipse-jee-2020-06-R-linux-gtk-x86_64.tar.gz 
	   
wget https://github.com/frekele/oracle-java/releases/download/8u212-b10/jdk-8u212-linux-x64.tar.gz
		tar -zxvf jdk-8u212-linux-x64.tar.gz 
```
